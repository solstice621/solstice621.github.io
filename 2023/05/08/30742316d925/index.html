<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"solstice621.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta property="og:type" content="article">
<meta property="og:title" content="CSAPP CHAP7 链接">
<meta property="og:url" content="https://solstice621.github.io/2023/05/08/30742316d925/index.html">
<meta property="og:site_name" content="qzh保护基地">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://solstice621.github.io/images/typora/image-20230509135411357.png">
<meta property="og:image" content="https://solstice621.github.io/images/typora/image-20230509141803013.png">
<meta property="og:image" content="https://solstice621.github.io/images/typora/image-20230509150652630.png">
<meta property="article:published_time" content="2023-05-08T09:25:59.000Z">
<meta property="article:modified_time" content="2023-05-09T07:35:54.735Z">
<meta property="article:author" content="裘子涵">
<meta property="article:tag" content="CSAPP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://solstice621.github.io/images/typora/image-20230509135411357.png">

<link rel="canonical" href="https://solstice621.github.io/2023/05/08/30742316d925/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>CSAPP CHAP7 链接 | qzh保护基地</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">qzh保护基地</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://solstice621.github.io/2023/05/08/30742316d925/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/IMG_0021(20210820-200930).JPG">
      <meta itemprop="name" content="裘子涵">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="qzh保护基地">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          CSAPP CHAP7 链接
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-05-08 17:25:59" itemprop="dateCreated datePublished" datetime="2023-05-08T17:25:59+08:00">2023-05-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-05-09 15:35:54" itemprop="dateModified" datetime="2023-05-09T15:35:54+08:00">2023-05-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">笔记</span></a>
                </span>
            </span>

          
            <div class="post-description"></div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="符号和符号表">符号和符号表</h2>
<p>每个可重定位目标模块<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.986ex" height="1.025ex" role="img" focusable="false" viewbox="0 -442 878 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g></g></g></svg></mjx-container>都有一个符号表,包含<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.986ex" height="1.025ex" role="img" focusable="false" viewbox="0 -442 878 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g></g></g></svg></mjx-container>定义和引用的信息.</p>
<p>在链接器上下文中,有三种不同的符号:</p>
<ol>
<li>全局符号: 由模块<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.986ex" height="1.025ex" role="img" focusable="false" viewbox="0 -442 878 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g></g></g></svg></mjx-container>定义并能被其他模块引用的全局符号,对应<strong>非静态C函数和全局变量</strong></li>
<li>外部符号: 由其他模块定义并被<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.986ex" height="1.025ex" role="img" focusable="false" viewbox="0 -442 878 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g></g></g></svg></mjx-container>引用的全局符号,对应<strong>在其他模块中定义的非静态C函数和全局变量</strong></li>
<li>局部符号: 只被模块<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.986ex" height="1.025ex" role="img" focusable="false" viewbox="0 -442 878 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g></g></g></svg></mjx-container>定义和引用的符号,对应<strong>带static属性的C函数和全局变量</strong>,在模块<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.025ex;" xmlns="http://www.w3.org/2000/svg" width="1.986ex" height="1.025ex" role="img" focusable="false" viewbox="0 -442 878 453"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D45A" d="M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"/></g></g></g></svg></mjx-container>中任何位置都可见,但不能被其他模块引用</li>
</ol>
<p><code>.symtab</code>符号表中不包含<strong>对应于本地非静态程序变量的任何符号</strong>,这些符号运行时在栈中被管理</p>
<p>(静态程序变量: 具有静态存储期的变量: 静态局部变量与全局变量(默认静态))</p>
<p>定义为带有C static属性的本地过程变量不在栈中管理,编译器在<code>.data</code>或<code>.bss</code>中为每个定义分配空间,并在符号表中创建一个唯一名字的本地链接器符号,如:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="C"><figure class="iseeu highlight /c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">f</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> x=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">}</span><br><span class="line"><span class="type">int</span> <span class="title function_">g</span><span class="params">()</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">static</span> <span class="type">int</span> x=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> x;</span><br><span class="line">}</span><br></pre></td></tr></table></figure></div>
<p>这种情况中,编译器向汇编器输出两个不同名字的局部链接器符号,比如用<code>x.1</code>表示<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="1.244ex" height="2.059ex" role="img" focusable="false" viewbox="0 -705 550 910"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"/></g></g></g></svg></mjx-container>中的定义,用<code>x.2</code>表示<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.464ex;" xmlns="http://www.w3.org/2000/svg" width="1.079ex" height="1.464ex" role="img" focusable="false" viewbox="0 -442 477 647"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D454" d="M311 43Q296 30 267 15T206 0Q143 0 105 45T66 160Q66 265 143 353T314 442Q361 442 401 394L404 398Q406 401 409 404T418 412T431 419T447 422Q461 422 470 413T480 394Q480 379 423 152T363 -80Q345 -134 286 -169T151 -205Q10 -205 10 -137Q10 -111 28 -91T74 -71Q89 -71 102 -80T116 -111Q116 -121 114 -130T107 -144T99 -154T92 -162L90 -164H91Q101 -167 151 -167Q189 -167 211 -155Q234 -144 254 -122T282 -75Q288 -56 298 -13Q311 35 311 43ZM384 328L380 339Q377 350 375 354T369 368T359 382T346 393T328 402T306 405Q262 405 221 352Q191 313 171 233T151 117Q151 38 213 38Q269 38 323 108L331 118L384 328Z"/></g></g></g></svg></mjx-container>中的定义</p>
<p>符号表由汇编器构造,使用编译器输出到汇编语言<code>.s</code>文件中的符号</p>
<p><code>.symtab</code>节中包含ELF符号表,这张符号表包含一个条目的数组</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="C"><figure class="iseeu highlight /c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>{</span></span><br><span class="line">    <span class="type">int</span> name;<span class="comment">//字符表(.strtab)中字节偏移,指向符号名字(是一个以null结尾的字符串)</span></span><br><span class="line">    <span class="type">char</span> type:<span class="number">4</span>,<span class="comment">//符号类型:数据/函数</span></span><br><span class="line">    	 binding:<span class="number">4</span>;<span class="comment">//符号类型:本地/全局</span></span><br><span class="line">    <span class="type">char</span> reserved;<span class="comment">//Unused</span></span><br><span class="line">    <span class="type">short</span> section;<span class="comment">//位于哪个节中,到节头部表索引</span></span><br><span class="line">    <span class="type">long</span> value;<span class="comment">//可重定位文件-距定义的节的起始位置的偏移,可执行文件-运行时的绝对地址</span></span><br><span class="line">    <span class="type">long</span> size;<span class="comment">//对象的大小</span></span><br><span class="line">}Elf64_Symbol;</span><br></pre></td></tr></table></figure></div>
<p>有三个特殊的<em>伪节</em>,在节头部表中没有条目:<br>
<code>ABS</code>代表不该被重定位的符号</p>
<p><code>UNDEF</code>表示未定义的符号:在<strong>本目标模块中引用,但是其他地方定义的符号</strong></p>
<p><code>COMMON</code>表示还未被分配位置的未初始化的数据模板</p>
<p><strong>只有可重定位目标文件中才有这些伪节,可执行目标文件中没有</strong></p>
<p><code>COMMON</code>和<code>.bss</code>的区别:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAINTEXT"><figure class="iseeu highlight /plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">COMMON 未初始化的全局变量</span><br><span class="line">  .bss 未初始化的静态变量,以及初始化为0的全局或静态变量</span><br></pre></td></tr></table></figure></div>
<h2 id="符号解析">符号解析</h2>
<p>链接器解析符号引用的方法: 将每个引用与它输入的可重定位目标文件的符号表中的一个确定的符号定义关联起来.</p>
<p>和引用定义在相同模块中的局部符号的引用: 编辑器只允许每个模块中每个局部符号有一个定义.</p>
<p>静态局部变量也会有本地链接器符号,编译器要确保他们拥有唯一名字.</p>
<p>对全局符号的引用解析: 当编译器遇到一个不是在当前模块中定义的符号,会<strong>假设</strong>该符号在其他某个模块中定义的,生成一个链接器符号表条目,并把它交给链接器处理.如果链接器在它的任何输入模块中都找不到这个被引用富豪的定义,就输出一条错误信息并停止.</p>
<h3 id="链接器如何解析多重定义的全局符号">链接器如何解析多重定义的全局符号</h3>
<p>链接器的输入是一组可重定位目标模块.如果多个模块定义同名的全局符号,Linux系统采用以下方法:</p>
<p>编译时,编译器向汇编器输出每个全局符号(强/弱)</p>
<p>函数和已初始化的全局变量是<strong>强符号</strong></p>
<p>未初始化的全局变量是<strong>弱符号</strong></p>
<ol>
<li>不允许有多个同名的强符号</li>
<li>如果一个强符号和多个弱符号同名,选择强符号</li>
<li>如果多个弱符号同名,从这些弱符号中任选一个</li>
</ol>
<h3 id="与静态库链接">与静态库链接</h3>
<p>将所有相关目标模块打包为一个单独的文件,称为静态库,可用作链接器的输入</p>
<p>当链接器构造一个输出的可执行文件时,只复制静态库里被应用程序引用的模块</p>
<p>例如<code>ISO C99</code>定义了一组广泛的标准I/O,字符串操作和证书数学函数,对每个C程序都可用</p>
<p>如果不使用静态库,编译器开发人员如何向用户提供函数:</p>
<ol>
<li>
<p>让编译器辨认出对标准函数的调用,并直接生成相应代码(Pascal),对C语言不合适,因为C标准定义了大量标准函数,会给编译器增加显著复杂性.每次添加,修改,删除标准函数都需要一个新的编译器版本.</p>
</li>
<li>
<p>将所有标准C函数放在一个单独的可重定位模块中,应用程序员把这个模块链接到他们的可执行文件中.</p>
<p>优点: 将编译器的实现与标准函数分开</p>
<p>缺点:</p>
<ol>
<li>
<p>每个可执行文件都包含一份标准函数的完全副本,<strong>浪费很大磁盘空间</strong>.</p>
</li>
<li>
<p>每个正在运行的程序都把这些函数的副本放在内存中,<strong>浪费很大内存</strong>.</p>
</li>
<li>
<p>对标准函数的任何改变,无论多小,都要求库的开发人员<strong>重新编译整个源文件</strong>.</p>
</li>
</ol>
</li>
<li>
<p>为每个标准函数创建一个独立的可重定位文件.要求应用程序员<strong>显式地链接</strong>合适的目标模块到它们地可执行文件中,容易出错且耗时.</p>
</li>
</ol>
<p>静态库: 相关函数可以被编译为独立的目标模块,然后封装成一个单独的静态库文件.</p>
<p>在链接时,链接器只复制被程序引用的目标模块,减小了可执行文件在磁盘和内存中的大小.</p>
<h2 id="重定位">重定位</h2>
<p>链接器完成了符号解析, 知道它的输入目标模块中的代码节和数据节的确切大小,就可以开始重定位步骤:</p>
<ol>
<li>重定位节和符号定义: 在这一步中,链接器将<strong>所有相同类型的节合并为同一类型的新的聚合节</strong>(例如将所有输入模块的<code>.data</code>节合并成一个<code>.data</code>节),然后将运行时的内存地址赋给新的聚合节,赋给输入模块定义的每个节,以及赋给模块定义的每个符号,完成后程序中的每条指令和全局变量都有<strong>唯一的运行时的内存地址</strong>.</li>
<li>重定位节中的符号引用: 链接器修改代码节和数据节中每个符号的引用,使他们指向正确的运行时地址.这一步依赖于可重定位目标模块中的<strong>重定位条目</strong>.</li>
</ol>
<h3 id="重定位条目">重定位条目</h3>
<p>汇编器生成一个目标模块时,并不知道数据和代码最终放在内存中的什么位置,也不知道模块引用的任何外部定义的函数或全局变量的位置.任何时候汇编器遇到最终位置未知的目标引用,就生成一个重定位条目,告诉链接器在将目标文件合并成可执行文件时如何修改这个引用.</p>
<p>代码的重定位条目放在<code>.rel.text</code>中,已初始化数据的重定位条目放在<code>.rel.data</code>中</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="C"><figure class="iseeu highlight /c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>{</span></span><br><span class="line">    <span class="type">long</span> offset;    <span class="comment">//需要被修改的引用的节偏移（即该符号引用距离所在节的初始位置的偏移）</span></span><br><span class="line">    <span class="type">long</span> type:<span class="number">32</span>;   <span class="comment">//重定位类型，不同的重定位类型会用不同的方式来修改引用</span></span><br><span class="line">    	 symbol:<span class="number">32</span>; <span class="comment">//symbol table index,指向被修改引用应该指向的符号</span></span><br><span class="line">    <span class="type">long</span> addend;    <span class="comment">//一个有符号常数，一些类型的重定位要使用它对被修改引用的值做偏移调整     </span></span><br><span class="line">}Elf64_Rela;</span><br></pre></td></tr></table></figure></div>
<p>ELF定义了32种不同的重定位类型,我们只关心最基本的两种:</p>
<ol>
<li>
<p><code>R_X86_64_PC32</code> 重定位一个使用<strong>32位PC相对地址</strong>的引用</p>
<p>一个PC相对地址就是距程序计数器(PC)的当前运行时值的偏移量,当CPU执行一条PC相对寻址的指令时,它就将在指令中编码的32位值加上PC的当前运行时的值,得到有效地址.PC值通常是吓一跳指令在内存中的地址.</p>
</li>
<li>
<p><code>R_X86_64_32</code> 重定位一个使用32位绝对地址的引用</p>
</li>
</ol>
<h2 id="可执行目标文件">可执行目标文件</h2>
<p><img src="/images/typora/image-20230509135411357.png" alt="image-20230509135411357"></p>
<p>ELF头描述文件的<strong>总体格式</strong>,还包含程序的<strong>入口点</strong>(程序运行时要执行的第一条指令的地址)</p>
<p><code>.text</code>,<code>.rodata</code>,<code>.data</code>与可重定位目标文件中的节相似</p>
<p><code>.init</code>节定义了一个小函数,叫做<code>_init</code>,用于程序初始化代码</p>
<p>可执行文件是<strong>完全链接</strong>(已被重定位)的,因此不再需要<code>rel</code>节</p>
<h2 id="加载可执行目标文件">加载可执行目标文件</h2>
<p>Linux shell 中运行可执行目标文件的方式：<strong>在命令行中输入文件的名字</strong>（用带 ./ 的相对路径表示）。</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt;</span><span class="language-bash">&gt;./prog.o</span></span><br></pre></td></tr></table></figure></div>
<p>上面运行了文件 <code>prog.o</code>，因为 prog 不是一个内置的 shell 命令，所以 shell 会认为 prog 是一个可执行目标文件，通过调用<strong>加载器</strong>（是操作系统中的一个程序）来运行它。</p>
<p><strong>加载</strong>：加载器将可执行目标文件的代码和数据从磁盘复制到内存，然后跳转到程序的第一条指令或入口点来运行程序。</p>
<p>任何 Linux 程序都可以<strong>通过execve函数来调用加载器</strong>。</p>
<p>每个 Linux 程序都有一个运行时内存映像。<strong>代码段总是从 0x400000 处开始</strong>，后面是<strong>数据段</strong>，然后是<strong>运行时堆段</strong>，通过调用 malloc 库往上增长。堆后面的区域是为共享模块保留的。用户栈总是从最大的用户地址<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.186ex;" xmlns="http://www.w3.org/2000/svg" width="6.816ex" height="2.09ex" role="img" focusable="false" viewbox="0 -841.7 3012.6 923.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="TeXAtom" transform="translate(533,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"/><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z" transform="translate(500,0)"/></g></g></g><g data-mml-node="mo" transform="translate(1512.3,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="mn" transform="translate(2512.6,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"/></g></g></g></svg></mjx-container>开始,向较小地区增长.栈上区域从地址<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: 0;" xmlns="http://www.w3.org/2000/svg" width="2.919ex" height="1.904ex" role="img" focusable="false" viewbox="0 -841.7 1290.1 841.7"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"/></g><g data-mml-node="TeXAtom" transform="translate(533,363) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"/><path data-c="38" d="M70 417T70 494T124 618T248 666Q319 666 374 624T429 515Q429 485 418 459T392 417T361 389T335 371T324 363L338 354Q352 344 366 334T382 323Q457 264 457 174Q457 95 399 37T249 -22Q159 -22 101 29T43 155Q43 263 172 335L154 348Q133 361 127 368Q70 417 70 494ZM286 386L292 390Q298 394 301 396T311 403T323 413T334 425T345 438T355 454T364 471T369 491T371 513Q371 556 342 586T275 624Q268 625 242 625Q201 625 165 599T128 534Q128 511 141 492T167 463T217 431Q224 426 228 424L286 386ZM250 21Q308 21 350 55T392 137Q392 154 387 169T375 194T353 216T330 234T301 253T274 270Q260 279 244 289T218 306L210 311Q204 311 181 294T133 239T107 157Q107 98 150 60T250 21Z" transform="translate(500,0)"/></g></g></g></g></g></svg></mjx-container>开始,<strong>为内核中的代码和数据保留</strong>.<strong>内核就是操作系统驻留在内存的部分</strong>.</p>
<p><strong>加载器的工作过程</strong></p>
<p>加载器运行时，创建一个内存映像（虚拟地址空间），在程序头部表的引导下，<strong>将可执行文件的片复制到代码段和数据段</strong>。然后加载器跳转到程序的入口点，即 _start 函数的地址（函数在系统目标文件 ctrl.o 中定义），_start 函数调用系统启动函数 __libc_start_main（定义在 libc.o 中），__libc_start_main 初始化执行环境，调用用户层的 main 函数，处理 main 函数的返回值，并在需要时把控制返回给内核。</p>
<p><img src="/images/typora/image-20230509141803013.png" alt="image-20230509141803013"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAINTEXT"><figure class="iseeu highlight /plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">用户栈（User Stack）和运行时堆（Runtime Heap）都是计算机程序在运行时用于存储数据的内存区域，但它们的用途和管理方式有所不同。以下是主要的区别：</span><br><span class="line"></span><br><span class="line">管理方式：</span><br><span class="line"></span><br><span class="line">堆（Heap）：堆是由程序在运行时动态管理的内存区域。当你需要在运行时分配内存（例如，使用 C++ 的 new 或 C 的 malloc()）时，这部分内存就来自堆。这种内存的分配和释放需要程序员手动进行，也就是说，你需要显式地释放你申请的内存，否则可能会导致内存泄漏。</span><br><span class="line"></span><br><span class="line">栈（Stack）：栈是由程序自动管理的内存区域。当你调用函数时，函数的局部变量和返回地址都会被自动压入栈中，当函数返回时，这些信息会被自动弹出。因此，你无需手动分配或释放栈内存，这些都由编译器和运行时系统自动处理。</span><br><span class="line"></span><br><span class="line">存储内容：</span><br><span class="line"></span><br><span class="line">堆（Heap）：堆用于存储程序运行时动态分配的数据。这些数据的大小和生存期在编译时并不确定，而是在运行时决定。</span><br><span class="line"></span><br><span class="line">栈（Stack）：栈用于存储函数调用的上下文信息，包括函数的局部变量、返回地址和参数等。栈的特点是支持后进先出（LIFO）的数据访问模式，即最后压入栈的元素首先被弹出。</span><br><span class="line"></span><br><span class="line">生命周期：</span><br><span class="line"></span><br><span class="line">堆（Heap）：堆上的数据在手动释放之前都会保留。这意味着，除非你显式地释放内存，否则堆上的数据将在程序的整个运行期间都存在。</span><br><span class="line"></span><br><span class="line">栈（Stack）：栈上的数据只在函数调用期间存在。当函数返回时，其在栈上的数据就会被自动清除。</span><br><span class="line"></span><br><span class="line">空间大小：</span><br><span class="line"></span><br><span class="line">堆（Heap）：堆的大小通常比栈大得多，因为堆需要存储程序运行时可能需要的所有动态分配的数据。</span><br><span class="line"></span><br><span class="line">栈（Stack）：栈的大小通常比堆小，因为栈只需要存储当前活动函数调用的数据。如果程序的函数调用深度过大或者函数的局部变量过多，可能会导致栈溢出。</span><br><span class="line"></span><br><span class="line">总的来说，堆和栈的主要区别在于管理方式、存储内容、生命周期和空间大小。堆用于存储动态分配的数据，由程序员管理，而栈用于存储函数调用的上下文信息，由程序自动管理。</span><br></pre></td></tr></table></figure></div>
<h2 id="动态链接共享库">动态链接共享库</h2>
<p>静态库仍然有一些明显的缺点</p>
<ol>
<li>静态库和其他所有软件一样,需要定期维护.如果程序员要使用一个库的最新版本,需要以某种方式了解到该库的更新情况,然后<strong>显式的将他们的程序与更新的库重新连接</strong></li>
<li>每个C程序都会使用I/O函数,比如<code>printf</code>和<code>scanf</code>,在运行时这些函数的代码会被复制到每个运行进程的文本段.在运行上百个进程的典型系统上,这将是<strong>对稀缺内存系统资源的极大浪费</strong>.</li>
</ol>
<p>共享库是一个目标模块,在运行和加载时,<strong>可以加载到任意的内存地址</strong>,并和一个在内存中的程序链接起来,这个过程称为动态链接,是由一个叫做动态链接器的程序来执行的.共享库也称为共享目标,在Linux系统中通常用<code>.so</code>后缀来表示.微软的操作系统大量的使用了共享库,称为<code>DLL</code>(动态链接库)</p>
<p>共享库以两种不同的方式来"共享"</p>
<ol>
<li>
<p>在给定的文件系统中,对于一个库只有一个<code>.so</code>文件,所有引用该库的可执行目标文件<strong>共享</strong>这个<code>.so</code><strong>文件中的代码和数据</strong>,而不是像静态库的内容那样<strong>被复制和嵌入</strong>到他们的可执行文件中.</p>
</li>
<li>
<p>在内存中,一个共享库的<code>.text</code>节的一个副本可以<strong>被不同的正在运行的进程共享</strong>.</p>
</li>
</ol>
<p><img src="/images/typora/image-20230509150652630.png" alt="image-20230509150652630"></p>
<p>↑创建一个可执行文件<code>prog21</code>,此文件的形式使得它在运行时可以和<code>libvector.so</code>链接.</p>
<p>基本思路是创建可执行文件时,静态执行一些链接.</p>
<p>然后<strong>在程序加载时</strong>,<strong>动态完成链接过程</strong>.此时,没有任何<code>libvector.so</code>的代码和数据节真的被复制到可执行文件<code>prog21</code>中.<strong>链接器复制了一些重定位和符号表信息</strong>,使得运行时可以解析对<code>libvector.so</code>中代码和数据的引用.</p>
<p>当加载器加载和运行可执行文件<code>prog21</code>时,利用<code>7.9节</code>中讨论过的技术,加载部分链接的可执行文件<code>prog21</code>,接着注意到<code>prog21</code>包含一个<code>.interp</code>节(包含一个动态链接器的路径名),动态链接器本身就是一个共享目标.</p>
<p>加载器加载和运行这个动态链接器,动态链接器执行以下<strong>重定位</strong>完成链接任务:</p>
<ol>
<li>重定位<code>lib.so</code>的文本和数据到某个内存段</li>
<li>重定位<code>libvector.so</code>的文本和数据到另一个内存段</li>
<li>重定位<code>prog21</code>中所有对由<code>lib.so</code>和<code>libvector</code>定义的符号的引用</li>
</ol>
<p>最后动态链接器将控制传递给应用程序.此时共享库位置固定,并且在程序执行过程中不会改变.</p>
<h2 id="从应用程序中加载和链接共享库">从应用程序中加载和链接共享库</h2>
<p><strong>动态链接</strong>：应用程序在<strong>运行时</strong>要求动态链接器加载和链接某个共享库（共享库即动态链接库）。</p>
<p>动态链接的应用：</p>
<ol>
<li><strong>分发软件</strong>。软件开发者常利用共享库来分发软件更新，它们生成共享库的新版本，用户只需要下载共享库并替代当前版本，下一次运行应用程序时，应用将自动链接和加载新的共享库。</li>
<li><strong>构建高性能 Web 服务器</strong>：许多 Web 服务器使用基于动态链接的方法来生成动态内容。将每个生成动态内容的函数打包在共享库中，当一个浏览器请求达到时，服务器就动态加载并链接相应函数，然后直接调用它，而非创建新的进程来运行函数。</li>
</ol>
<h2 id="位置无关代码">位置无关代码</h2>
<p>多个进程如何共享程序的一个副本?</p>
<p>现代系统以一种方式编译共享模块的代码段,使得它们<strong>加载到内存的任何位置而无需链接器修改</strong>.使用这种方法,无限多个进程可以<strong>共享一个共享模块的代码段的单一副本</strong>.</p>
<p>可以加载而无需重定位的代码称为<strong>位置无关代码</strong></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/CSAPP/" rel="tag"># CSAPP</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2023/05/06/9934737015eb/" rel="prev" title="力扣435 无重叠区间">
      <i class="fa fa-chevron-left"></i> 力扣435 无重叠区间
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%A6%E5%8F%B7%E5%92%8C%E7%AC%A6%E5%8F%B7%E8%A1%A8"><span class="nav-number">1.</span> <span class="nav-text">符号和符号表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AC%A6%E5%8F%B7%E8%A7%A3%E6%9E%90"><span class="nav-number">2.</span> <span class="nav-text">符号解析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%93%BE%E6%8E%A5%E5%99%A8%E5%A6%82%E4%BD%95%E8%A7%A3%E6%9E%90%E5%A4%9A%E9%87%8D%E5%AE%9A%E4%B9%89%E7%9A%84%E5%85%A8%E5%B1%80%E7%AC%A6%E5%8F%B7"><span class="nav-number">2.1.</span> <span class="nav-text">链接器如何解析多重定义的全局符号</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8E%E9%9D%99%E6%80%81%E5%BA%93%E9%93%BE%E6%8E%A5"><span class="nav-number">2.2.</span> <span class="nav-text">与静态库链接</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E5%AE%9A%E4%BD%8D"><span class="nav-number">3.</span> <span class="nav-text">重定位</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%87%8D%E5%AE%9A%E4%BD%8D%E6%9D%A1%E7%9B%AE"><span class="nav-number">3.1.</span> <span class="nav-text">重定位条目</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6"><span class="nav-number">4.</span> <span class="nav-text">可执行目标文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A0%E8%BD%BD%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%9B%AE%E6%A0%87%E6%96%87%E4%BB%B6"><span class="nav-number">5.</span> <span class="nav-text">加载可执行目标文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E9%93%BE%E6%8E%A5%E5%85%B1%E4%BA%AB%E5%BA%93"><span class="nav-number">6.</span> <span class="nav-text">动态链接共享库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8E%E5%BA%94%E7%94%A8%E7%A8%8B%E5%BA%8F%E4%B8%AD%E5%8A%A0%E8%BD%BD%E5%92%8C%E9%93%BE%E6%8E%A5%E5%85%B1%E4%BA%AB%E5%BA%93"><span class="nav-number">7.</span> <span class="nav-text">从应用程序中加载和链接共享库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%8D%E7%BD%AE%E6%97%A0%E5%85%B3%E4%BB%A3%E7%A0%81"><span class="nav-number">8.</span> <span class="nav-text">位置无关代码</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="裘子涵"
      src="/images/IMG_0021(20210820-200930).JPG">
  <p class="site-author-name" itemprop="name">裘子涵</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">55</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">37</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">裘子涵</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='150' src="/lib/canvas-nest/canvas-nest-nomobile.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  

</body>
</html>
